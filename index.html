<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub Twórcy - Official World</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updatePassword } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, collection, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAAYQapOciCUgy_o6I18i7oWH4VG7M7LCA",
            authDomain: "ub-tworcy-adrion.firebaseapp.com",
            projectId: "ub-tworcy-adrion",
            storageBucket: "ub-tworcy-adrion.firebasestorage.app",
            messagingSenderId: "726610553428",
            appId: "1:726610553428:web:c4ac55e28fa46dd0439bc1"
        };

        // Twój email Szefa - musi pasować do tego w Rules w Firebase
        const BOSS_EMAIL = "adrianniekil@gmail.com";

        let app, auth, db, mainDocRef;
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) { console.error("Firebase init error", e); }

        // --- SYNCHRONIZACJA DANYCH ---
        function initDataSync() {
            mainDocRef = doc(db, 'projects', 'ub-tworcy-adrion', 'public_data', 'hub_content');

            onSnapshot(mainDocRef, (snapshot) => {
                document.getElementById('cloud-status-text').innerText = "Online";
                document.getElementById('cloud-status-text').style.color = "#22c55e";
                
                if (snapshot.exists()) {
                    const data = snapshot.data();
                    window.dispatchEvent(new CustomEvent('cloudDataUpdated', { detail: data }));
                } else {
                    // Inicjalizacja bazy (tylko Szef da radę to zrobić przez Rules)
                    if(window.DEFAULT_DATA_TEMPLATE) setDoc(mainDocRef, window.DEFAULT_DATA_TEMPLATE).catch(e=>{});
                }
            }, (error) => {
                if(error.code === 'permission-denied') {
                    // Goście widzą błąd przy nasłuchu jeśli nie mają uprawnień do zapisu? Nie, do odczytu mają.
                    // Ale w razie czego:
                    console.log("Tryb tylko do odczytu (lub błąd reguł)");
                }
            });
        }

        window.addEventListener('load', initDataSync);

        // --- API ---
        window.cloudAPI = {
            auth: auth,
            // Zapis głównych danych (Posty/Produkty) - Tylko dla Szefa
            saveContent: async (newData) => {
                window.dispatchEvent(new CustomEvent('cloudDataUpdated', { detail: newData })); // Optymistycznie
                try { await setDoc(mainDocRef, newData, { merge: true }); } 
                catch (e) { 
                    if(e.code === 'permission-denied') showToast("Tylko Szef może edytować treść!", "error");
                    else console.error(e);
                }
            },
            // Zapis profilu użytkownika (do osobnej kolekcji)
            saveUserProfile: async (uid, data) => {
                try {
                    await setDoc(doc(db, 'projects', 'ub-tworcy-adrion', 'users', uid), data, { merge: true });
                    // Odśwież lokalnie
                    if(!APP_DATA.users) APP_DATA.users = {};
                    APP_DATA.users[uid] = data;
                    renderAll(); 
                } catch(e) { console.error("Save profile error", e); }
            },
            // Pobranie wszystkich użytkowników (Dla Admina i do wyświetlania komentarzy)
            fetchAllUsers: async () => {
                try {
                    const querySnapshot = await getDocs(collection(db, 'projects', 'ub-tworcy-adrion', 'users'));
                    const usersMap = {};
                    querySnapshot.forEach((doc) => { usersMap[doc.id] = doc.data(); });
                    return usersMap;
                } catch(e) { return {}; }
            },
            login: (e, p) => signInWithEmailAndPassword(auth, e, p),
            register: (e, p) => createUserWithEmailAndPassword(auth, e, p),
            logout: () => signOut(auth),
            updatePass: (p) => updatePassword(auth.currentUser, p)
        };

        // --- LOGIKA APLIKACJI ---
        window.DEFAULT_DATA_TEMPLATE = {
            config: {
                firstName: "ADRION", lastName: "___",   
                bio: "Lifestyle, moda i codzienne vlogi.",
                avatarUrl: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=1964&auto=format&fit=crop",
                email: "kontakt@twojadomena.pl",
                stats: { youtube: "10K", instagram: "14.5K", projects: "5" },
                links: { instagram: "https://www.instagram.com/___adrion___/" }
            },
            posts: [{ id: 101, type: 'status', title: 'Start', text: 'Witaj w świecie Adrion.', date: new Date().toISOString(), likes: 0, likedBy: [], comments: [] }],
            products: []
        };

        const CACHE_KEY = 'hub_data_v2';
        let APP_DATA = JSON.parse(localStorage.getItem(CACHE_KEY) || JSON.stringify(window.DEFAULT_DATA_TEMPLATE));
        // Lokalny cache użytkowników (do szybkiego wyświetlania)
        APP_DATA.users = APP_DATA.users || {};

        let currentUser = null;
        let isAdmin = false;
        let currentUploadBase64 = '';

        // Obsługa aktualizacji z chmury
        window.addEventListener('cloudDataUpdated', (e) => {
            if(e.detail) {
                // Zachowaj users, bo przychodzą tylko posty/produkty z głównego pliku
                const usersBackup = APP_DATA.users;
                APP_DATA = e.detail;
                APP_DATA.users = usersBackup || {}; 
                renderAll();
            }
        });

        // Obsługa logowania
        if(window.cloudAPI) {
            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                if (user) {
                    // Sprawdź czy to szef
                    isAdmin = (user.email === BOSS_EMAIL);
                    
                    // Pobierz aktualne dane użytkownika z bazy
                    const userDoc = await getDoc(doc(db, 'projects', 'ub-tworcy-adrion', 'users', user.uid));
                    if(userDoc.exists()) {
                        APP_DATA.users[user.uid] = userDoc.data();
                    } else {
                        // Jeśli nie ma profilu w bazie (np. stare konto), stwórz go
                        const initialData = { nick: user.email.split('@')[0], role: isAdmin ? 'admin' : 'user', email: user.email };
                        await window.cloudAPI.saveUserProfile(user.uid, initialData);
                        APP_DATA.users[user.uid] = initialData;
                    }

                    // Pobierz listę wszystkich użytkowników (żeby widzieć ich nicki/avatary)
                    const allUsers = await window.cloudAPI.fetchAllUsers();
                    APP_DATA.users = { ...APP_DATA.users, ...allUsers };
                    
                    showToast(isAdmin ? "Witaj Szefie!" : "Zalogowano pomyślnie");
                } else {
                    isAdmin = false;
                }
                updateUI();
                renderAll();
            });
        }

        // --- FUNKCJE UI ---
        function updateUI() {
            // Admin panel toggle
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(el => isAdmin ? el.classList.remove('hidden') : el.classList.add('hidden'));

            // Navbar items
            if(currentUser) {
                document.getElementById('user-menu-guest').classList.add('hidden');
                document.getElementById('user-menu-logged').classList.remove('hidden');
                // Avatar w nav
                const myProfile = APP_DATA.users[currentUser.uid] || {};
                document.getElementById('nav-user-avatar').src = myProfile.avatar || `https://ui-avatars.com/api/?name=${currentUser.email}&background=random`;
                
                // Modal Profile View
                document.getElementById('user-display-name').innerText = myProfile.nick || "Użytkownik";
                document.getElementById('user-email-display').innerText = currentUser.email;
                document.getElementById('user-avatar-main').src = myProfile.avatar || document.getElementById('nav-user-avatar').src;
                
                // Form Fields
                document.getElementById('edit-nick').value = myProfile.nick || "";
                document.getElementById('edit-avatar').value = myProfile.avatar || "";
                
                document.getElementById('admin-badge').style.display = isAdmin ? 'inline-block' : 'none';
            } else {
                document.getElementById('user-menu-guest').classList.remove('hidden');
                document.getElementById('user-menu-logged').classList.add('hidden');
            }
        }

        // --- AKCJE UŻYTKOWNIKA ---
        async function handleLogin() {
            setLoading('btn-login', true);
            try {
                await window.cloudAPI.login(document.getElementById('login-email').value, document.getElementById('login-pass').value);
                closeModal();
            } catch(e) { showToast("Błąd: " + e.message, "error"); }
            setLoading('btn-login', false);
        }

        async function handleRegister() {
            setLoading('btn-reg', true);
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            const nick = document.getElementById('reg-nick').value;
            try {
                const cred = await window.cloudAPI.register(email, pass);
                // Tworzymy profil w bazie 'users'
                await window.cloudAPI.saveUserProfile(cred.user.uid, {
                    nick: nick,
                    email: email,
                    role: 'user',
                    avatar: '',
                    joined: new Date().toISOString()
                });
                closeModal();
                showToast("Konto utworzone!");
            } catch(e) { showToast("Błąd: " + e.message, "error"); }
            setLoading('btn-reg', false);
        }

        async function saveProfileChanges() {
            if(!currentUser) return;
            const newNick = document.getElementById('edit-nick').value;
            const newAvatar = currentUploadBase64 || document.getElementById('edit-avatar').value;
            const newPass = document.getElementById('edit-pass').value;

            if(newPass) {
                try { await window.cloudAPI.updatePass(newPass); showToast("Hasło zmienione"); }
                catch(e) { showToast("Błąd hasła: " + e.message, "error"); return; }
            }

            const updateData = { nick: newNick };
            if(newAvatar) updateData.avatar = newAvatar;

            await window.cloudAPI.saveUserProfile(currentUser.uid, updateData);
            showToast("Profil zaktualizowany!");
            currentUploadBase64 = ''; // Reset
        }

        // --- ADMIN ACTIONS ---
        function adminAddPost() {
            if(!isAdmin) return;
            const title = document.getElementById('admin-post-title').value;
            if(!title) return showToast("Brak tytułu", "error");
            
            const newPost = {
                id: Date.now(),
                title: title,
                text: document.getElementById('admin-post-text').value,
                type: document.getElementById('admin-post-type').value,
                image: currentUploadBase64,
                videoUrl: document.getElementById('admin-post-video').value,
                date: new Date().toISOString(),
                likes: 0, likedBy: [], comments: []
            };
            
            APP_DATA.posts.unshift(newPost);
            window.cloudAPI.saveContent(APP_DATA);
            showToast("Opublikowano");
            currentUploadBase64 = '';
        }

        function adminAddProduct() {
            if(!isAdmin) return;
            const name = document.getElementById('admin-prod-name').value;
            if(!name) return;
            
            const prod = {
                id: Date.now(),
                name: name,
                price: document.getElementById('admin-prod-price').value,
                img: currentUploadBase64 || 'https://via.placeholder.com/300',
                label: document.getElementById('admin-prod-label').value
            };
            APP_DATA.products.push(prod);
            window.cloudAPI.saveContent(APP_DATA);
            showToast("Produkt dodany");
            currentUploadBase64 = '';
        }

        // --- RENDERERS ---
        function renderAll() {
            renderBlog();
            renderShop();
            renderAdminUsers();
            
            // Profil Info
            const config = APP_DATA.config;
            document.getElementById('nav-logo').innerHTML = `${config.firstName}<span class="text-brand-purple">${config.lastName}</span>`;
            document.getElementById('profile-name').innerHTML = document.getElementById('nav-logo').innerHTML;
            document.getElementById('profile-bio').innerText = config.bio;
            document.getElementById('profile-avatar').src = config.avatarUrl;
            
            document.getElementById('stat-yt').innerText = config.stats.youtube;
            document.getElementById('stat-ig').innerText = config.stats.instagram;
            document.getElementById('stat-proj').innerText = config.stats.projects;
        }

        function renderBlog() {
            const container = document.getElementById('blog-container');
            if(!APP_DATA.posts?.length) { container.innerHTML = '<div class="text-center p-10 text-gray-400">Brak postów</div>'; return; }
            
            container.innerHTML = APP_DATA.posts.map(p => {
                let media = '';
                if(p.type === 'photo' && p.image) media = `<img src="${p.image}" class="w-full rounded-lg mb-3">`;
                if(p.type === 'video') media = `<div class="bg-black text-white p-4 rounded-lg mb-3 text-center cursor-pointer" onclick="window.open('${p.videoUrl}', '_blank')"><i class="fas fa-play mb-2 block"></i>Otwórz Wideo</div>`;

                // Komentarze
                const commentsHtml = (p.comments || []).map((c, i) => {
                    // Szukamy avatara usera w załadowanych userach
                    // c.author to u nas UID (najlepiej) lub nick. Przyjmijmy że zapisujemy UID i Nick.
                    // Tutaj uproszczenie: w starej wersji było nick.
                    return `<div class="text-xs border-b border-gray-100 py-1 flex justify-between group">
                        <span><b>${c.author}:</b> ${c.text}</span>
                        ${isAdmin ? `<i class="fas fa-times text-red-400 cursor-pointer opacity-0 group-hover:opacity-100" onclick="deleteComment(${p.id}, ${i})"></i>` : ''}
                    </div>`
                }).join('');

                return `
                <div class="bg-white p-5 rounded-2xl shadow-soft mb-6 break-inside-avoid relative group">
                    ${isAdmin ? `<button onclick="deletePost(${p.id})" class="absolute top-2 right-2 text-red-500 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fas fa-trash"></i></button>` : ''}
                    ${media}
                    <h3 class="font-bold text-lg text-black">${p.title}</h3>
                    <p class="text-sm text-gray-600 mt-1">${p.text || ''}</p>
                    <div class="flex justify-between items-center mt-4 text-xs text-gray-400">
                        <span>${new Date(p.date).toLocaleDateString()}</span>
                        <div class="flex gap-3">
                            <button onclick="document.getElementById('comments-${p.id}').classList.toggle('hidden')"><i class="far fa-comment"></i> ${p.comments?.length || 0}</button>
                            <button onclick="likePost(${p.id})" class="${(p.likedBy||[]).includes(currentUser?.uid) ? 'text-red-500' : ''}"><i class="far fa-heart"></i> ${p.likes || 0}</button>
                        </div>
                    </div>
                    <div id="comments-${p.id}" class="hidden mt-3 pt-3 border-t border-gray-100">
                        <div class="max-h-32 overflow-y-auto mb-2">${commentsHtml}</div>
                        ${currentUser ? `<div class="flex gap-2"><input id="comment-in-${p.id}" class="w-full bg-gray-50 border p-1 rounded text-xs text-black" placeholder="Napisz..."><button onclick="addComment(${p.id})" class="text-brand-purple"><i class="fas fa-paper-plane"></i></button></div>` : ''}
                    </div>
                </div>`;
            }).join('');
        }

        function renderAdminUsers() {
            if(!isAdmin) return;
            const tbody = document.getElementById('admin-users-list');
            if(!tbody) return;
            
            // APP_DATA.users zawiera mapę UID -> dane
            const users = Object.entries(APP_DATA.users || {});
            document.getElementById('admin-user-count').innerText = users.length;
            
            tbody.innerHTML = users.map(([uid, u]) => `
                <tr class="border-b border-gray-100 text-sm">
                    <td class="p-3">
                        <div class="font-bold text-black">${u.nick || 'Bez nicku'}</div>
                        <div class="text-xs text-gray-400">${u.email || '...'}</div>
                    </td>
                    <td class="p-3">${u.role || 'user'}</td>
                    <td class="p-3 text-right text-xs text-gray-400">${uid.substr(0,5)}...</td>
                </tr>
            `).join('');
        }

        // --- AKCJE LOGIKI ---
        function likePost(pid) {
            if(!currentUser) return showToast("Zaloguj się", "error");
            const p = APP_DATA.posts.find(x => x.id === pid);
            if(!p.likedBy) p.likedBy = [];
            const uid = currentUser.uid;
            if(p.likedBy.includes(uid)) {
                p.likedBy = p.likedBy.filter(x => x !== uid);
                p.likes--;
            } else {
                p.likedBy.push(uid);
                p.likes++;
            }
            window.cloudAPI.saveContent(APP_DATA);
        }

        function addComment(pid) {
            const txt = document.getElementById(`comment-in-${pid}`).value;
            if(!txt) return;
            const p = APP_DATA.posts.find(x => x.id === pid);
            if(!p.comments) p.comments = [];
            
            const myNick = APP_DATA.users[currentUser.uid]?.nick || "Anonim";
            p.comments.push({ author: myNick, text: txt, uid: currentUser.uid });
            window.cloudAPI.saveContent(APP_DATA);
        }

        function deletePost(pid) {
            if(confirm("Usunąć?")) {
                APP_DATA.posts = APP_DATA.posts.filter(x => x.id !== pid);
                window.cloudAPI.saveContent(APP_DATA);
            }
        }
        function deleteComment(pid, idx) {
            const p = APP_DATA.posts.find(x => x.id === pid);
            p.comments.splice(idx, 1);
            window.cloudAPI.saveContent(APP_DATA);
        }

        // --- UTILS ---
        function handleFile(e) {
            const f = e.target.files[0];
            if(!f) return;
            const r = new FileReader();
            r.onload = (ev) => {
                // Resize logic simplified
                const img = new Image();
                img.onload = () => {
                    const c = document.createElement('canvas');
                    const ctx = c.getContext('2d');
                    const scale = Math.min(800/img.width, 1);
                    c.width = img.width * scale;
                    c.height = img.height * scale;
                    ctx.drawImage(img,0,0,c.width,c.height);
                    currentUploadBase64 = c.toDataURL('image/jpeg', 0.7);
                    showToast("Zdjęcie gotowe");
                };
                img.src = ev.target.result;
            };
            r.readAsDataURL(f);
        }

        function showToast(msg, type='success') {
            const t = document.createElement('div');
            t.className = `toast ${type}`;
            t.innerText = msg;
            document.getElementById('toast-container').appendChild(t);
            setTimeout(() => t.remove(), 3000);
        }
        function setLoading(id, s) { 
            const b = document.getElementById(id); 
            if(s) { b.innerHTML = '...'; b.disabled=true; } 
            else { b.innerHTML = b.dataset.txt || 'OK'; b.disabled=false; } 
        }
        function switchTab(t) {
            document.querySelectorAll('main > div').forEach(d => d.classList.add('hidden'));
            document.getElementById('view-'+t).classList.remove('hidden');
        }
        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); }
        function handleAuthClick() { 
            if(currentUser) {
                // Show profile modal
                document.getElementById('auth-modal').classList.remove('hidden');
                document.getElementById('user-view').classList.remove('hidden');
                document.getElementById('login-view').classList.add('hidden');
            } else {
                document.getElementById('auth-modal').classList.remove('hidden');
                document.getElementById('user-view').classList.add('hidden');
                document.getElementById('login-view').classList.remove('hidden');
            }
        }
        function closeModal() { document.getElementById('auth-modal').classList.add('hidden'); }
        function toggleAuthMode(mode) {
            if(mode === 'reg') {
                document.getElementById('form-login').classList.add('hidden');
                document.getElementById('form-register').classList.remove('hidden');
            } else {
                document.getElementById('form-login').classList.remove('hidden');
                document.getElementById('form-register').classList.add('hidden');
            }
        }
    </script>

    <!-- STYLE UŻYTKOWE -->
    <style>
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: white; color: #111; padding: 10px 20px; border-left: 4px solid #8b5cf6; border-radius: 8px; shadow: 0 5px 15px rgba(0,0,0,0.1); animation: slideIn 0.3s; font-size: 14px; font-weight: 500; }
        .toast.error { border-left-color: #ef4444; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .masonry-grid { column-count: 1; gap: 1.5rem; }
        @media(min-width: 768px) { .masonry-grid { column-count: 2; } }
        @media(min-width: 1024px) { .masonry-grid { column-count: 3; } }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

    <!-- CLOUD STATUS -->
    <div class="fixed bottom-2 left-2 bg-white px-3 py-1 rounded-full text-[10px] text-gray-400 border shadow flex items-center gap-2 z-50">
        <div class="w-2 h-2 rounded-full bg-gray-300" id="cloud-status-text"></div> Stan
    </div>
    <div id="toast-container"></div>

    <!-- ADMIN BAR -->
    <div id="admin-bar" class="admin-only hidden bg-gradient-to-r from-purple-600 to-pink-500 text-white text-center text-xs font-bold py-1">PANEL SZEFA</div>

    <!-- NAV -->
    <nav class="sticky top-0 bg-white/90 backdrop-blur border-b border-gray-200 z-40 h-16 flex items-center justify-between px-4 lg:px-8">
        <div id="nav-logo" class="font-display font-black text-2xl tracking-tighter">HUB</div>
        <div class="flex gap-6 text-sm font-bold text-gray-500">
            <button onclick="switchTab('feed')" class="hover:text-purple-600">VLOG</button>
            <button onclick="switchTab('shop')" class="hover:text-purple-600">SKLEP</button>
            <button onclick="switchTab('admin')" class="admin-only hidden text-red-500 hover:text-red-700">ZARZĄDZAJ</button>
        </div>
        <div class="flex gap-4 items-center">
            <!-- Ikona usera -->
            <div id="user-menu-guest" class="cursor-pointer" onclick="handleAuthClick()"><i class="far fa-user text-xl"></i></div>
            <div id="user-menu-logged" class="hidden cursor-pointer" onclick="handleAuthClick()">
                <img id="nav-user-avatar" class="w-8 h-8 rounded-full border bg-gray-100 object-cover">
            </div>
            
            <div class="relative cursor-pointer" onclick="toggleCart()">
                <i class="fas fa-shopping-bag text-xl"></i>
            </div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 pt-8 pb-20">
        
        <!-- FEED -->
        <div id="view-feed">
            <div class="flex flex-col md:flex-row gap-8 mb-12 items-center md:items-start">
                <img id="profile-avatar" class="w-32 h-32 rounded-full border-4 border-white shadow-lg object-cover">
                <div class="flex-1 text-center md:text-left">
                    <h1 id="profile-name" class="text-4xl font-display font-black mb-2">...</h1>
                    <p id="profile-bio" class="text-gray-500 max-w-md">...</p>
                </div>
                <div class="flex gap-6 text-center">
                    <div><div id="stat-yt" class="text-2xl font-black">-</div><div class="text-[10px] text-gray-400">YOUTUBE</div></div>
                    <div><div id="stat-ig" class="text-2xl font-black">-</div><div class="text-[10px] text-gray-400">INSTA</div></div>
                    <div><div id="stat-proj" class="text-2xl font-black">-</div><div class="text-[10px] text-gray-400">PROJEKTY</div></div>
                </div>
            </div>
            <div id="blog-container" class="masonry-grid"></div>
        </div>

        <!-- SHOP -->
        <div id="view-shop" class="hidden">
            <h2 class="text-center text-3xl font-black mb-8">SKLEP</h2>
            <div id="products-container" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
        </div>

        <!-- ADMIN -->
        <div id="view-admin" class="hidden admin-only">
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-2xl border">
                    <h3 class="font-bold mb-4">Dodaj Post</h3>
                    <input id="admin-post-title" class="w-full border p-2 rounded mb-2" placeholder="Tytuł">
                    <textarea id="admin-post-text" class="w-full border p-2 rounded mb-2" placeholder="Treść"></textarea>
                    <select id="admin-post-type" class="w-full border p-2 rounded mb-2">
                        <option value="status">Tekst</option>
                        <option value="photo">Zdjęcie</option>
                        <option value="video">Wideo</option>
                    </select>
                    <input type="file" onchange="handleFile(event)" class="mb-2 text-xs">
                    <input id="admin-post-video" class="w-full border p-2 rounded mb-2" placeholder="Link YT">
                    <button onclick="adminAddPost()" class="w-full bg-purple-600 text-white font-bold p-2 rounded">Publikuj</button>
                </div>
                
                <div class="bg-white p-6 rounded-2xl border">
                    <h3 class="font-bold mb-4">Użytkownicy (<span id="admin-user-count">0</span>)</h3>
                    <div class="overflow-y-auto max-h-60">
                        <table class="w-full text-left">
                            <tbody id="admin-users-list"></tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl border">
                    <h3 class="font-bold mb-4">Dodaj Produkt</h3>
                    <input id="admin-prod-name" class="w-full border p-2 rounded mb-2" placeholder="Nazwa">
                    <input id="admin-prod-price" class="w-full border p-2 rounded mb-2" placeholder="Cena">
                    <input id="admin-prod-label" class="w-full border p-2 rounded mb-2" placeholder="Label">
                    <button onclick="adminAddProduct()" class="w-full bg-green-600 text-white font-bold p-2 rounded">Dodaj</button>
                </div>
            </div>
        </div>

    </main>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center hidden p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-black"><i class="fas fa-times"></i></button>
            
            <!-- LOGIN VIEW -->
            <div id="login-view">
                <div class="flex border-b mb-6">
                    <button onclick="toggleAuthMode('login')" class="flex-1 pb-2 border-b-2 border-purple-600 font-bold">Logowanie</button>
                    <button onclick="toggleAuthMode('reg')" class="flex-1 pb-2 text-gray-400">Rejestracja</button>
                </div>
                
                <div id="form-login">
                    <input id="login-email" class="w-full border p-3 rounded mb-3" placeholder="Email">
                    <input id="login-pass" type="password" class="w-full border p-3 rounded mb-4" placeholder="Hasło">
                    <button id="btn-login" onclick="handleLogin()" class="w-full bg-purple-600 text-white font-bold p-3 rounded hover:bg-purple-700">ZALOGUJ</button>
                </div>

                <div id="form-register" class="hidden">
                    <input id="reg-nick" class="w-full border p-3 rounded mb-3" placeholder="Nick">
                    <input id="reg-email" class="w-full border p-3 rounded mb-3" placeholder="Email">
                    <input id="reg-pass" type="password" class="w-full border p-3 rounded mb-4" placeholder="Hasło (min 6 znaków)">
                    <button id="btn-reg" onclick="handleRegister()" class="w-full bg-black text-white font-bold p-3 rounded hover:bg-gray-800">ZAŁÓŻ KONTO</button>
                </div>
            </div>

            <!-- USER PROFILE VIEW -->
            <div id="user-view" class="hidden text-center">
                <h2 class="font-bold text-xl mb-4">Twój Profil</h2>
                <img id="user-avatar-main" class="w-24 h-24 rounded-full mx-auto mb-2 border bg-gray-100 object-cover">
                <h3 id="user-display-name" class="font-bold text-lg">...</h3>
                <p id="user-email-display" class="text-xs text-gray-400 mb-4">...</p>
                
                <div id="admin-badge" class="hidden mb-4"><span class="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded border border-red-200">PANEL ADMINISTRATORA DOSTĘPNY</span></div>

                <div class="text-left bg-gray-50 p-4 rounded-xl mb-4">
                    <p class="text-xs font-bold text-gray-400 uppercase mb-2">Edytuj dane</p>
                    <input id="edit-nick" class="w-full border p-2 rounded mb-2 text-sm" placeholder="Nick">
                    <input id="edit-avatar" class="w-full border p-2 rounded mb-2 text-sm" placeholder="URL Avatara">
                    <input type="file" onchange="handleFile(event)" class="text-xs mb-2">
                    <input id="edit-pass" type="password" class="w-full border p-2 rounded mb-2 text-sm" placeholder="Nowe hasło">
                    <button onclick="saveProfileChanges()" class="w-full bg-gray-200 text-gray-800 font-bold p-2 rounded text-xs hover:bg-gray-300">ZAPISZ ZMIANY</button>
                </div>

                <button onclick="window.cloudAPI.logout(); closeModal();" class="w-full border border-red-200 text-red-500 font-bold p-2 rounded hover:bg-red-50">WYLOGUJ</button>
            </div>
        </div>
    </div>

    <!-- CART -->
    <div id="cart-modal" class="hidden fixed inset-0 z-50 flex justify-end">
        <div class="absolute inset-0 bg-black/50" onclick="toggleCart()"></div>
        <div class="bg-white w-full max-w-md h-full relative p-6 shadow-2xl">
            <h2 class="font-black text-2xl mb-6">KOSZYK</h2>
            <p class="text-gray-400">Pusto...</p>
        </div>
    </div>

</body>
</html>