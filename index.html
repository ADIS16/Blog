<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub Tw贸rcy - Official World</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updatePassword } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, collection, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAAYQapOciCUgy_o6I18i7oWH4VG7M7LCA",
            authDomain: "ub-tworcy-adrion.firebaseapp.com",
            projectId: "ub-tworcy-adrion",
            storageBucket: "ub-tworcy-adrion.firebasestorage.app",
            messagingSenderId: "726610553428",
            appId: "1:726610553428:web:c4ac55e28fa46dd0439bc1"
        };

        // ---  EMAIL SZEFA (Musi by identyczny jak w Firebase Rules) ---
        const BOSS_EMAIL = "adrianniekil@gmail.com";

        let app, auth, db, mainDocRef;
        
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) { console.error("Firebase init error", e); }

        // --- DANE LOKALNE ---
        window.DEFAULT_DATA_TEMPLATE = {
            config: {
                firstName: "ADRION", lastName: "___",   
                bio: "Lifestyle, moda i codzienne vlogi.",
                avatarUrl: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=1964&auto=format&fit=crop",
                email: "kontakt@twojadomena.pl",
                stats: { youtube: "10K", instagram: "14.5K", projects: "5" },
                links: { instagram: "https://www.instagram.com/___adrion___/" }
            },
            posts: [{ id: 101, type: 'status', title: 'Start', text: 'Witaj w wiecie Adrion.', date: new Date().toISOString(), likes: 0, likedBy: [], comments: [] }],
            products: []
        };

        const CACHE_KEY = 'hub_data_v3';
        let APP_DATA = JSON.parse(localStorage.getItem(CACHE_KEY) || JSON.stringify(window.DEFAULT_DATA_TEMPLATE));
        if(!APP_DATA.users) APP_DATA.users = {};

        let currentUser = null;
        let isAdmin = false;
        let currentUploadBase64 = '';

        // --- SYNCHRONIZACJA DANYCH ---
        function initDataSync() {
            if(!db) return;
            mainDocRef = doc(db, 'projects', 'ub-tworcy-adrion', 'public_data', 'hub_content');

            onSnapshot(mainDocRef, (snapshot) => {
                const statusEl = document.getElementById('cloud-status-text');
                if(statusEl) {
                    statusEl.innerText = "Online";
                    statusEl.style.color = "#22c55e";
                }
                
                if (snapshot.exists()) {
                    const data = snapshot.data();
                    window.dispatchEvent(new CustomEvent('cloudDataUpdated', { detail: data }));
                } else {
                    // Tylko admin mo偶e zainicjowa
                    if(isAdmin) setDoc(mainDocRef, window.DEFAULT_DATA_TEMPLATE).catch(()=>{});
                }
            }, (error) => {
                console.log("Sync status:", error.code);
            });
        }

        window.addEventListener('load', initDataSync);
        window.addEventListener('cloudDataUpdated', (e) => {
            if(e.detail) {
                const usersBackup = APP_DATA.users; // Zachowaj user贸w
                APP_DATA = { ...e.detail, users: usersBackup };
                localStorage.setItem(CACHE_KEY, JSON.stringify(APP_DATA));
                renderAll();
            }
        });

        // --- API ---
        window.cloudAPI = {
            login: (e, p) => signInWithEmailAndPassword(auth, e, p),
            register: (e, p) => createUserWithEmailAndPassword(auth, e, p),
            logout: () => signOut(auth),
            updatePass: (p) => updatePassword(auth.currentUser, p),
            
            saveContent: async (newData) => {
                // Zapisz lokalnie natychmiast
                APP_DATA = newData;
                renderAll();
                localStorage.setItem(CACHE_KEY, JSON.stringify(APP_DATA));
                
                // Wylij do chmury
                if(mainDocRef) {
                    try { await setDoc(mainDocRef, newData, { merge: true }); }
                    catch(e) { 
                        if(e.code === 'permission-denied') showToast("Brak uprawnie Szefa (zmiana lokalna)", "warning");
                        else console.error(e);
                    }
                }
            },
            
            saveUserProfile: async (uid, data) => {
                // Lokalnie
                if(!APP_DATA.users) APP_DATA.users = {};
                APP_DATA.users[uid] = { ...APP_DATA.users[uid], ...data };
                renderAll();
                updateUI();
                
                // Chmura
                try {
                    await setDoc(doc(db, 'projects', 'ub-tworcy-adrion', 'users', uid), data, { merge: true });
                } catch(e) { console.warn("Nie udao si zapisa profilu w chmurze (bd uprawnie?)"); }
            },

            fetchAllUsers: async () => {
                try {
                    const querySnapshot = await getDocs(collection(db, 'projects', 'ub-tworcy-adrion', 'users'));
                    const usersMap = {};
                    querySnapshot.forEach((doc) => { usersMap[doc.id] = doc.data(); });
                    return usersMap;
                } catch(e) { return {}; }
            }
        };

        // --- OBSUGA LOGOWANIA ---
        if(auth) {
            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                
                if (user) {
                    // 1. Sprawd藕 czy to SZEF (po emailu)
                    isAdmin = (user.email && user.email.toLowerCase() === BOSS_EMAIL.toLowerCase());
                    
                    // 2. Pobierz profil z bazy (bezpiecznie)
                    try {
                        const userDoc = await getDoc(doc(db, 'projects', 'ub-tworcy-adrion', 'users', user.uid));
                        if(userDoc.exists()) {
                            APP_DATA.users[user.uid] = userDoc.data();
                        } else {
                            // Nowy profil
                            const initialData = { 
                                nick: user.email.split('@')[0], 
                                role: isAdmin ? 'admin' : 'user', 
                                email: user.email,
                                avatar: '' 
                            };
                            window.cloudAPI.saveUserProfile(user.uid, initialData);
                        }
                    } catch(e) {
                        console.warn("Bd pobierania profilu (mo偶e Rules?):", e);
                        // Fallback: stw贸rz lokalny profil 偶eby UI dziaao
                        if(!APP_DATA.users[user.uid]) {
                            APP_DATA.users[user.uid] = { nick: user.email.split('@')[0], avatar: '' };
                        }
                    }

                    // 3. Pobierz list innych (w tle)
                    window.cloudAPI.fetchAllUsers().then(users => {
                        APP_DATA.users = { ...APP_DATA.users, ...users };
                        renderAll();
                    });

                    showToast(isAdmin ? "Witaj Szefie!" : "Zalogowano");
                } else {
                    isAdmin = false;
                }
                
                updateUI();
                renderAll();
            });
        }

        // --- FUNKCJE UI ---
        function updateUI() {
            // Admin Panel
            document.querySelectorAll('.admin-only').forEach(el => {
                if(isAdmin) el.classList.remove('hidden');
                else el.classList.add('hidden');
            });

            // Nav & Modal
            if(currentUser) {
                document.getElementById('user-menu-guest').classList.add('hidden');
                document.getElementById('user-menu-logged').classList.remove('hidden');
                document.getElementById('form-login').classList.add('hidden');
                document.getElementById('auth-tabs').classList.add('hidden');
                document.getElementById('user-profile-view').classList.remove('hidden');
                document.getElementById('form-register').classList.add('hidden');

                const myData = APP_DATA.users[currentUser.uid] || {};
                const displayNick = myData.nick || currentUser.email.split('@')[0];
                const displayAvatar = myData.avatar || `https://ui-avatars.com/api/?name=${displayNick}&background=random`;

                document.getElementById('nav-user-avatar').src = displayAvatar;
                document.getElementById('user-avatar-main').src = displayAvatar;
                document.getElementById('user-display-name').innerText = displayNick;
                document.getElementById('user-email-display').innerText = currentUser.email;
                
                // Formularz edycji
                document.getElementById('edit-nick').value = displayNick;
                document.getElementById('edit-avatar').value = myData.avatar || '';
                
                if(isAdmin) document.getElementById('admin-badge').classList.remove('hidden');
                else document.getElementById('admin-badge').classList.add('hidden');

            } else {
                document.getElementById('user-menu-guest').classList.remove('hidden');
                document.getElementById('user-menu-logged').classList.add('hidden');
                document.getElementById('form-login').classList.remove('hidden');
                document.getElementById('auth-tabs').classList.remove('hidden');
                document.getElementById('user-profile-view').classList.add('hidden');
                document.getElementById('form-register').classList.add('hidden');
            }
        }

        // --- HANDLERY ---
        async function handleLogin() {
            setLoading('btn-login', true);
            try {
                await window.cloudAPI.login(
                    document.getElementById('login-email').value, 
                    document.getElementById('login-pass').value
                );
                closeModal();
            } catch(e) { 
                showToast("Bd: " + e.message, "error"); 
            } finally {
                setLoading('btn-login', false);
            }
        }

        async function handleRegister() {
            setLoading('btn-reg', true);
            try {
                const cred = await window.cloudAPI.register(
                    document.getElementById('reg-email').value, 
                    document.getElementById('reg-pass').value
                );
                // Zapisz profil
                const nick = document.getElementById('reg-nick').value;
                await window.cloudAPI.saveUserProfile(cred.user.uid, {
                    nick: nick,
                    email: cred.user.email,
                    role: 'user',
                    joined: new Date().toISOString()
                });
                
                closeModal();
                showToast("Konto utworzone!");
            } catch(e) {
                showToast("Bd: " + e.message, "error");
            } finally {
                setLoading('btn-reg', false);
            }
        }

        async function saveProfileChanges() {
            if(!currentUser) return;
            const newNick = document.getElementById('edit-nick').value;
            const newAvatar = currentUploadBase64 || document.getElementById('edit-avatar').value;
            const newPass = document.getElementById('edit-pass').value;

            if(newPass) {
                try { await window.cloudAPI.updatePass(newPass); showToast("Haso zmienione"); }
                catch(e) { showToast("Bd hasa: " + e.message, "error"); return; }
            }

            const updateData = { nick: newNick };
            if(newAvatar) updateData.avatar = newAvatar;

            await window.cloudAPI.saveUserProfile(currentUser.uid, updateData);
            showToast("Profil zaktualizowany!");
            currentUploadBase64 = '';
            document.getElementById('edit-pass').value = '';
        }

        // --- RENDERERS ---
        function renderAll() {
            renderBlog();
            renderShop();
            renderAdminUsers();
            
            const c = APP_DATA.config;
            if(c) {
                const nameHtml = `${c.firstName}<span class="text-brand-purple">${c.lastName}</span>`;
                document.getElementById('nav-logo').innerHTML = nameHtml;
                document.getElementById('profile-name').innerHTML = nameHtml;
                document.getElementById('profile-bio').innerText = c.bio;
                document.getElementById('profile-avatar').src = c.avatarUrl;
                document.getElementById('stat-yt').innerText = c.stats.youtube;
                document.getElementById('stat-ig').innerText = c.stats.instagram;
                document.getElementById('stat-proj').innerText = c.stats.projects;
            }
        }

        function renderBlog() {
            const container = document.getElementById('blog-container');
            if(!APP_DATA.posts?.length) { container.innerHTML = '<div class="text-center p-10 text-gray-400">Brak post贸w</div>'; return; }
            
            container.innerHTML = APP_DATA.posts.map(p => {
                let media = '';
                if(p.type === 'photo' && p.image) media = `<img src="${p.image}" class="w-full rounded-lg mb-3">`;
                if(p.type === 'video') media = `<div class="bg-black text-white p-4 rounded-lg mb-3 text-center cursor-pointer"><i class="fas fa-play mb-2 block"></i>Wideo</div>`;

                const commentsHtml = (p.comments || []).map((c, i) => {
                    const u = APP_DATA.users[c.uid] || {};
                    const nick = u.nick || c.author || "Go";
                    const av = u.avatar || `https://ui-avatars.com/api/?name=${nick}&background=random`;
                    return `<div class="text-sm mb-2 border-b border-gray-100 pb-1 flex gap-2">
                        <img src="${av}" class="w-6 h-6 rounded-full object-cover">
                        <div><span class="font-bold text-xs">${nick}:</span> <span class="text-gray-600 text-xs">${c.text}</span></div>
                        ${isAdmin ? `<i onclick="deleteComment(${p.id}, ${i})" class="fas fa-times text-red-300 ml-auto cursor-pointer"></i>` : ''}
                    </div>`;
                }).join('');

                return `<div class="bg-white p-5 rounded-2xl shadow-soft mb-6 relative group">
                    ${isAdmin ? `<button onclick="deletePost(${p.id})" class="absolute top-2 right-2 text-red-500 opacity-0 group-hover:opacity-100"><i class="fas fa-trash"></i></button>` : ''}
                    ${media}
                    <h3 class="font-bold text-lg">${p.title}</h3>
                    <p class="text-sm text-gray-600">${p.text}</p>
                    <div class="flex justify-between items-center mt-3 text-xs text-gray-400">
                        <span>${new Date(p.date).toLocaleDateString()}</span>
                        <div class="flex gap-3">
                            <button onclick="document.getElementById('comm-${p.id}').classList.toggle('hidden')"><i class="far fa-comment"></i> ${p.comments?.length||0}</button>
                            <button onclick="likePost(${p.id})" class="${(p.likedBy||[]).includes(currentUser?.uid)?'text-red-500':''}"><i class="far fa-heart"></i> ${p.likes||0}</button>
                        </div>
                    </div>
                    <div id="comm-${p.id}" class="hidden mt-3 pt-3 border-t">
                        <div class="max-h-32 overflow-y-auto mb-2">${commentsHtml}</div>
                        ${currentUser ? `<div class="flex gap-2"><input id="in-c-${p.id}" class="w-full border rounded p-1 text-xs" placeholder="Napisz..."><button onclick="addComment(${p.id})" class="text-brand-purple"><i class="fas fa-paper-plane"></i></button></div>` : ''}
                    </div>
                </div>`;
            }).join('');
        }

        function renderShop() {
            const el = document.getElementById('products-container');
            if(APP_DATA.products?.length) {
                el.innerHTML = APP_DATA.products.map(p => `
                    <div class="bg-white p-4 rounded-xl shadow-sm relative group">
                        ${isAdmin ? `<button onclick="deleteProduct(${p.id})" class="absolute top-2 right-2 text-red-500 opacity-0 group-hover:opacity-100"><i class="fas fa-trash"></i></button>` : ''}
                        <img src="${p.img}" class="w-full h-32 object-cover rounded mb-2">
                        <h4 class="font-bold text-sm">${p.name}</h4>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded">${p.price} PLN</span>
                            <button onclick="addToCart(${p.id})" class="text-brand-purple text-xs font-bold">DODAJ</button>
                        </div>
                    </div>
                `).join('');
            } else { el.innerHTML = '<p class="col-span-3 text-center text-gray-400">Brak produkt贸w</p>'; }
        }

        function renderAdminUsers() {
            if(!isAdmin) return;
            const list = Object.entries(APP_DATA.users || {}).map(([uid, u]) => `
                <tr class="border-b text-xs">
                    <td class="p-2 font-bold">${u.nick}</td>
                    <td class="p-2 text-gray-500">${u.email}</td>
                    <td class="p-2">${u.role}</td>
                </tr>`).join('');
            document.getElementById('admin-users-list').innerHTML = list;
            document.getElementById('admin-user-count').innerText = Object.keys(APP_DATA.users).length;
        }

        // --- AKCJE ---
        function likePost(pid) {
            if(!currentUser) return showToast("Zaloguj si", "error");
            const p = APP_DATA.posts.find(x => x.id === pid);
            if(!p.likedBy) p.likedBy = [];
            const uid = currentUser.uid;
            if(p.likedBy.includes(uid)) { p.likedBy = p.likedBy.filter(x => x!==uid); p.likes--; }
            else { p.likedBy.push(uid); p.likes++; }
            window.cloudAPI.saveContent(APP_DATA);
        }
        function addComment(pid) {
            const txt = document.getElementById(`in-c-${pid}`).value;
            if(!txt) return;
            const p = APP_DATA.posts.find(x => x.id === pid);
            if(!p.comments) p.comments = [];
            p.comments.push({ uid: currentUser.uid, text: txt, author: APP_DATA.users[currentUser.uid]?.nick });
            window.cloudAPI.saveContent(APP_DATA);
            document.getElementById(`in-c-${pid}`).value = '';
        }
        function deletePost(pid) { if(confirm("Usun?")) { APP_DATA.posts = APP_DATA.posts.filter(x=>x.id!==pid); window.cloudAPI.saveContent(APP_DATA); } }
        function deleteProduct(pid) { if(confirm("Usun?")) { APP_DATA.products = APP_DATA.products.filter(x=>x.id!==pid); window.cloudAPI.saveContent(APP_DATA); } }
        function deleteComment(pid, idx) { APP_DATA.posts.find(x=>x.id===pid).comments.splice(idx,1); window.cloudAPI.saveContent(APP_DATA); }
        
        function adminAddPost() {
            const t = document.getElementById('admin-post-title').value;
            if(!t) return;
            APP_DATA.posts.unshift({
                id: Date.now(), title: t, text: document.getElementById('admin-post-text').value,
                type: document.getElementById('admin-post-type').value, image: currentUploadBase64,
                date: new Date().toISOString(), likes: 0, likedBy: [], comments: []
            });
            window.cloudAPI.saveContent(APP_DATA);
            showToast("Dodano post");
        }
        function adminAddProduct() {
            const n = document.getElementById('admin-prod-name').value;
            if(!n) return;
            APP_DATA.products.push({
                id: Date.now(), name: n, price: document.getElementById('admin-prod-price').value,
                img: currentUploadBase64 || 'https://via.placeholder.com/150'
            });
            window.cloudAPI.saveContent(APP_DATA);
            showToast("Dodano produkt");
        }

        // --- UTILS ---
        function handleFile(e) {
            const f = e.target.files[0];
            if(!f) return;
            const r = new FileReader();
            r.onload = (ev) => {
                const img = new Image();
                img.onload = () => {
                    const c = document.createElement('canvas');
                    const ctx = c.getContext('2d');
                    const s = Math.min(800/img.width, 1);
                    c.width = img.width*s; c.height = img.height*s;
                    ctx.drawImage(img,0,0,c.width,c.height);
                    currentUploadBase64 = c.toDataURL('image/jpeg',0.7);
                    showToast("Gotowe");
                };
                img.src = ev.target.result;
            };
            r.readAsDataURL(f);
        }
        function addToCart(id) { showToast("Dodano do koszyka"); } // Prosta wersja
        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); }
        function showToast(m, t='success') {
            const d = document.createElement('div');
            d.className = `toast ${t}`; d.innerText = m;
            document.getElementById('toast-container').appendChild(d);
            setTimeout(()=>d.remove(), 3000);
        }
        function setLoading(id, s) {
            const b = document.getElementById(id);
            if(s) { b.disabled=true; b.innerHTML = '...'; }
            else { b.disabled=false; b.innerHTML = b.id==='btn-reg'?'ZA呕':'ZALOGUJ'; }
        }
        function handleAuthClick() {
            if(currentUser) { 
                document.getElementById('auth-modal').classList.remove('hidden'); 
                document.getElementById('form-login').classList.add('hidden'); // Ensure login hidden
            }
            else { 
                document.getElementById('auth-modal').classList.remove('hidden'); 
                toggleAuthMode('login'); // Reset to login view
            }
        }
        function closeModal() { document.getElementById('auth-modal').classList.add('hidden'); }
        function toggleAuthMode(m) {
            document.getElementById('form-login').classList.toggle('hidden', m!=='login');
            document.getElementById('form-register').classList.toggle('hidden', m!=='reg');
            document.getElementById('tab-login').className = m==='login' ? 'flex-1 pb-2 border-b-2 border-purple-600 font-bold' : 'flex-1 pb-2 text-gray-400';
            document.getElementById('tab-register').className = m==='reg' ? 'flex-1 pb-2 border-b-2 border-purple-600 font-bold' : 'flex-1 pb-2 text-gray-400';
        }
        function switchTab(t) {
            document.querySelectorAll('main > div').forEach(e=>e.classList.add('hidden'));
            document.getElementById('view-'+t).classList.remove('hidden');
        }

        renderAll();
    </script>

    <style>
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: white; color: #111; padding: 10px 20px; border-left: 4px solid #8b5cf6; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); animation: slideIn 0.3s; font-size: 14px; font-weight: 500; }
        .toast.error { border-left-color: #ef4444; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        .masonry-grid { column-count: 1; gap: 1.5rem; }
        @media(min-width: 768px) { .masonry-grid { column-count: 2; } }
        @media(min-width: 1024px) { .masonry-grid { column-count: 3; } }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 font-sans">

    <!-- CLOUD STATUS -->
    <div class="fixed bottom-2 left-2 bg-white px-3 py-1 rounded-full text-[10px] text-gray-400 border shadow flex items-center gap-2 z-50">
        <div class="w-2 h-2 rounded-full bg-gray-300" id="cloud-status-text"></div> Stan
    </div>
    <div id="toast-container"></div>

    <!-- ADMIN BAR -->
    <div id="admin-bar" class="admin-only hidden bg-gradient-to-r from-purple-600 to-pink-500 text-white text-center text-xs font-bold py-1">PANEL SZEFA</div>

    <!-- NAV -->
    <nav class="sticky top-0 bg-white/90 backdrop-blur border-b border-gray-200 z-40 h-16 flex items-center justify-between px-4 lg:px-8">
        <div id="nav-logo" class="font-display font-black text-2xl tracking-tighter cursor-pointer" onclick="switchTab('feed')">HUB</div>
        <div class="flex gap-6 text-sm font-bold text-gray-500">
            <button onclick="switchTab('feed')" class="hover:text-purple-600">VLOG</button>
            <button onclick="switchTab('shop')" class="hover:text-purple-600">SKLEP</button>
            <button onclick="switchTab('admin')" class="admin-only hidden text-red-500 hover:text-red-700">ZARZDZAJ</button>
        </div>
        <div class="flex gap-4 items-center">
            <div id="user-menu-guest" class="cursor-pointer" onclick="handleAuthClick()"><i class="far fa-user text-xl"></i></div>
            <div id="user-menu-logged" class="hidden cursor-pointer group relative" onclick="handleAuthClick()">
                <img id="nav-user-avatar" class="w-8 h-8 rounded-full border bg-gray-100 object-cover">
                <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 border-2 border-white rounded-full"></div>
            </div>
            <div class="relative cursor-pointer" onclick="toggleCart()"><i class="fas fa-shopping-bag text-xl"></i></div>
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-4 pt-8 pb-20">
        
        <!-- FEED -->
        <div id="view-feed">
            <div class="flex flex-col md:flex-row gap-8 mb-12 items-center md:items-start">
                <img id="profile-avatar" class="w-32 h-32 rounded-full border-4 border-white shadow-lg object-cover">
                <div class="flex-1 text-center md:text-left">
                    <h1 id="profile-name" class="text-4xl font-display font-black mb-2">...</h1>
                    <p id="profile-bio" class="text-gray-500 max-w-md">...</p>
                </div>
                <div class="flex gap-6 text-center">
                    <div><div id="stat-yt" class="text-2xl font-black">-</div><div class="text-[10px] text-gray-400">YOUTUBE</div></div>
                    <div><div id="stat-ig" class="text-2xl font-black">-</div><div class="text-[10px] text-gray-400">INSTA</div></div>
                    <div><div id="stat-proj" class="text-2xl font-black">-</div><div class="text-[10px] text-gray-400">PROJEKTY</div></div>
                </div>
            </div>
            <div id="blog-container" class="masonry-grid"></div>
        </div>

        <!-- SHOP -->
        <div id="view-shop" class="hidden">
            <h2 class="text-center text-3xl font-black mb-8">SKLEP</h2>
            <div id="products-container" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
        </div>

        <!-- ADMIN -->
        <div id="view-admin" class="hidden admin-only">
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-2xl border">
                    <h3 class="font-bold mb-4">Dodaj Post</h3>
                    <input id="admin-post-title" class="w-full border p-2 rounded mb-2" placeholder="Tytu">
                    <textarea id="admin-post-text" class="w-full border p-2 rounded mb-2" placeholder="Tre"></textarea>
                    <select id="admin-post-type" class="w-full border p-2 rounded mb-2">
                        <option value="status">Tekst</option>
                        <option value="photo">Zdjcie</option>
                        <option value="video">Wideo</option>
                    </select>
                    <input type="file" onchange="handleFile(event)" class="mb-2 text-xs">
                    <button onclick="adminAddPost()" class="w-full bg-purple-600 text-white font-bold p-2 rounded">Publikuj</button>
                </div>
                <div class="bg-white p-6 rounded-2xl border">
                    <h3 class="font-bold mb-4">Dodaj Produkt</h3>
                    <input id="admin-prod-name" class="w-full border p-2 rounded mb-2" placeholder="Nazwa">
                    <input id="admin-prod-price" class="w-full border p-2 rounded mb-2" placeholder="Cena">
                    <button onclick="adminAddProduct()" class="w-full bg-green-600 text-white font-bold p-2 rounded">Dodaj</button>
                </div>
                <div class="bg-white p-6 rounded-2xl border md:col-span-2">
                    <h3 class="font-bold mb-4">U偶ytkownicy (<span id="admin-user-count">0</span>)</h3>
                    <div class="overflow-y-auto max-h-60">
                        <table class="w-full text-left"><tbody id="admin-users-list"></tbody></table>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center hidden p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm p-6 relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-black"><i class="fas fa-times"></i></button>
            
            <!-- TABS -->
            <div id="auth-tabs" class="flex border-b mb-6">
                <button onclick="toggleAuthMode('login')" id="tab-login" class="flex-1 pb-2 border-b-2 border-purple-600 font-bold">Logowanie</button>
                <button onclick="toggleAuthMode('reg')" id="tab-register" class="flex-1 pb-2 text-gray-400">Rejestracja</button>
            </div>
            
            <!-- LOGIN FORM -->
            <div id="form-login">
                <input id="login-email" class="w-full border p-3 rounded mb-3" placeholder="Email">
                <input id="login-pass" type="password" class="w-full border p-3 rounded mb-4" placeholder="Haso">
                <button id="btn-login" onclick="handleLogin()" class="w-full bg-purple-600 text-white font-bold p-3 rounded hover:bg-purple-700">ZALOGUJ</button>
            </div>

            <!-- REGISTER FORM -->
            <div id="form-register" class="hidden">
                <input id="reg-nick" class="w-full border p-3 rounded mb-3" placeholder="Nick">
                <input id="reg-email" class="w-full border p-3 rounded mb-3" placeholder="Email">
                <input id="reg-pass" type="password" class="w-full border p-3 rounded mb-4" placeholder="Haso (min 6 znak贸w)">
                <button id="btn-reg" onclick="handleRegister()" class="w-full bg-black text-white font-bold p-3 rounded hover:bg-gray-800">ZA呕 KONTO</button>
            </div>

            <!-- USER PROFILE VIEW -->
            <div id="user-profile-view" class="hidden text-center">
                <h2 class="font-bold text-xl mb-4 border-b pb-2">TWJ PROFIL</h2>
                <img id="user-avatar-main" class="w-24 h-24 rounded-full mx-auto mb-2 border bg-gray-100 object-cover shadow-lg">
                <h3 id="user-display-name" class="font-bold text-lg">...</h3>
                <p id="user-email-display" class="text-xs text-gray-400 mb-4">...</p>
                <div id="admin-badge" class="hidden mb-4"><span class="bg-red-100 text-red-600 text-xs font-bold px-2 py-1 rounded border border-red-200">SZEF</span></div>

                <div class="text-left bg-gray-50 p-4 rounded-xl mb-4 space-y-2">
                    <p class="text-[10px] font-bold text-gray-400 uppercase">EDYCJA DANYCH</p>
                    <input id="edit-nick" class="w-full border p-2 rounded text-sm bg-white" placeholder="Nick">
                    <input id="edit-avatar" class="w-full border p-2 rounded text-sm bg-white" placeholder="Link do avatara (URL)">
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-400">lub plik:</span>
                        <input type="file" onchange="handleFile(event)" class="text-xs w-full">
                    </div>
                    <input id="edit-pass" type="password" class="w-full border p-2 rounded text-sm bg-white" placeholder="Nowe haso (opcjonalnie)">
                    <button onclick="saveProfileChanges()" class="w-full bg-gray-800 text-white font-bold p-2 rounded text-xs hover:bg-black mt-2">ZAPISZ ZMIANY</button>
                </div>

                <button onclick="window.cloudAPI.logout(); closeModal();" class="w-full border border-red-200 text-red-500 font-bold p-2 rounded hover:bg-red-50 text-sm">WYLOGUJ</button>
            </div>
        </div>
    </div>

    <!-- CART -->
    <div id="cart-modal" class="hidden fixed inset-0 z-50 flex justify-end">
        <div class="absolute inset-0 bg-black/50" onclick="toggleCart()"></div>
        <div class="bg-white w-full max-w-md h-full relative p-6 shadow-2xl flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-black text-2xl">KOSZYK</h2>
                <button onclick="toggleCart()"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="flex-1 flex items-center justify-center text-gray-400">Koszyk jest pusty</div>
            <button class="w-full bg-purple-600 text-white font-bold p-4 rounded-xl mt-4">DO KASY</button>
        </div>
    </div>

</body>
</html>